{"ast":null,"code":"import _keys from \"lodash/keys\";\nvar _jsxFileName = \"/Users/cihanandac/Documents/code-files/utrechtsciencepark/utrecht-science-park/frontend/node_modules/@plone/volto/src/server.jsx\";\nvar __jsx = React.createElement;\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n/* eslint no-console: 0 */\nimport '@plone/volto/config'; // This is the bootstrap for the global config - server side\nimport { existsSync, lstatSync, readFileSync } from 'fs';\nimport React from 'react';\nimport { StaticRouter } from 'react-router-dom';\nimport { Provider } from 'react-intl-redux';\nimport express from 'express';\nimport { renderToString } from 'react-dom/server';\nimport { createMemoryHistory } from 'history';\nimport { parse as parseUrl } from 'url';\nimport locale from 'locale';\nimport { detect } from 'detect-browser';\nimport path from 'path';\nimport { ChunkExtractor, ChunkExtractorManager } from '@loadable/server';\nimport { resetServerContext } from 'react-beautiful-dnd';\nimport { CookiesProvider } from 'react-cookie';\nimport cookiesMiddleware from 'universal-cookie-express';\nimport debug from 'debug';\nimport routes from '@root/routes';\nimport config from '@plone/volto/registry';\nimport { flattenToAppURL, Html, Api, persistAuthToken, normalizeLanguageName, toLangUnderscoreRegion } from '@plone/volto/helpers';\nimport { changeLanguage } from '@plone/volto/actions';\nimport userSession from '@plone/volto/reducers/userSession/userSession';\nimport ErrorPage from '@plone/volto/error';\nimport languages from '@plone/volto/constants/Languages';\nimport configureStore from '@plone/volto/store';\nimport { ReduxAsyncConnect, loadOnServer } from './helpers/AsyncConnect';\nlet locales = {};\nif (config.settings) {\n  config.settings.supportedLanguages.forEach(lang => {\n    const langFileName = normalizeLanguageName(lang);\n    import('@root/../locales/' + langFileName + '.json').then(locale => {\n      locales = _objectSpread(_objectSpread({}, locales), {}, {\n        [lang]: locale.default\n      });\n    });\n  });\n}\nfunction reactIntlErrorHandler(error) {\n  debug('i18n')(error);\n}\nconst supported = new locale.Locales(_keys(languages), 'en');\nconst server = express().disable('x-powered-by').head('/*', function (req, res) {\n  // Support for HEAD requests. Required by start-test utility in CI.\n  res.send('');\n}).use(cookiesMiddleware());\nconst middleware = (config.settings.expressMiddleware || []).filter(m => m);\nserver.all('*', setupServer);\nif (middleware.length) server.use('/', middleware);\nserver.use(function (err, req, res, next) {\n  if (err) {\n    const {\n      store\n    } = res.locals;\n    const errorPage = __jsx(Provider, {\n      store: store,\n      onError: reactIntlErrorHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 7\n      }\n    }, __jsx(StaticRouter, {\n      context: {},\n      location: req.url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }\n    }, __jsx(ErrorPage, {\n      message: err.message,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 11\n      }\n    })));\n    res.set({\n      'Cache-Control': 'public, max-age=60, no-transform'\n    });\n\n    /* Displays error in console\n     * TODO:\n     * - get ignored codes from Plone error_log\n     */\n    const ignoredErrors = [301, 302, 401, 404];\n    if (!ignoredErrors.includes(err.status)) console.error(err);\n    res.status(err.status || 500) // If error happens in Volto code itself error status is undefined\n    .send(`<!doctype html> ${renderToString(errorPage)}`);\n  }\n});\nfunction setupServer(req, res, next) {\n  const api = new Api(req);\n  const lang = new locale.Locales(req.universalCookies.get('I18N_LANGUAGE') || config.settings.defaultLanguage || req.headers['accept-language']).best(supported).toString();\n\n  // Minimum initial state for the fake Redux store instance\n  const initialState = {\n    intl: {\n      defaultLocale: 'en',\n      locale: lang,\n      messages: locales[lang]\n    }\n  };\n  const history = createMemoryHistory({\n    initialEntries: [req.url]\n  });\n\n  // Create a fake Redux store instance for the `errorHandler` to render\n  // and for being used by the rest of the middlewares, if required\n  const store = configureStore(initialState, history, api);\n  function errorHandler(error) {\n    const errorPage = __jsx(Provider, {\n      store: store,\n      onError: reactIntlErrorHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 7\n      }\n    }, __jsx(StaticRouter, {\n      context: {},\n      location: req.url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }\n    }, __jsx(ErrorPage, {\n      message: error.message,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }\n    })));\n    res.set({\n      'Cache-Control': 'public, max-age=60, no-transform'\n    });\n\n    /* Displays error in console\n     * TODO:\n     * - get ignored codes from Plone error_log\n     */\n    const ignoredErrors = [301, 302, 401, 404];\n    if (!ignoredErrors.includes(error.status)) console.error(error);\n    res.status(error.status || 500) // If error happens in Volto code itself error status is undefined\n    .send(`<!doctype html> ${renderToString(errorPage)}`);\n  }\n  if (!process.env.RAZZLE_API_PATH && req.headers.host) {\n    res.locals.detectedHost = `${req.headers['x-forwarded-proto'] || req.protocol}://${req.headers.host}`;\n    config.settings.apiPath = res.locals.detectedHost;\n    config.settings.publicURL = res.locals.detectedHost;\n  }\n  res.locals = _objectSpread(_objectSpread({}, res.locals), {}, {\n    store,\n    api,\n    errorHandler\n  });\n  next();\n}\nserver.get('/*', (req, res) => {\n  const {\n    errorHandler\n  } = res.locals;\n  const api = new Api(req);\n  const browserdetect = detect(req.headers['user-agent']);\n  const lang = new locale.Locales(req.universalCookies.get('I18N_LANGUAGE') || config.settings.defaultLanguage || req.headers['accept-language']).best(supported).toString();\n  const authToken = req.universalCookies.get('auth_token');\n  const initialState = {\n    userSession: _objectSpread(_objectSpread({}, userSession()), {}, {\n      token: authToken\n    }),\n    form: req.body,\n    intl: {\n      defaultLocale: 'en',\n      locale: lang,\n      messages: locales[lang]\n    },\n    browserdetect\n  };\n  const history = createMemoryHistory({\n    initialEntries: [req.url]\n  });\n\n  // Create a new Redux store instance\n  const store = configureStore(initialState, history, api);\n  persistAuthToken(store, req);\n\n  // @loadable/server extractor\n  const buildDir = process.env.BUILD_DIR || 'build';\n  const extractor = new ChunkExtractor({\n    statsFile: path.resolve(path.join(buildDir, 'loadable-stats.json')),\n    entrypoints: ['client']\n  });\n  const url = req.originalUrl || req.url;\n  const location = parseUrl(url);\n  loadOnServer({\n    store,\n    location,\n    routes,\n    api\n  }).then(() => {\n    var _store$getState$conte, _store$getState$conte2, _store$getState$conte3;\n    const cookie_lang = req.universalCookies.get('I18N_LANGUAGE') || config.settings.defaultLanguage || req.headers['accept-language'];\n\n    // The content info is in the store at this point thanks to the asynconnect\n    // features, then we can force the current language info into the store when\n    // coming from an SSR request\n\n    // TODO: there is a bug here with content that, for any reason, doesn't\n    // present the language token field, for some reason. In this case, we\n    // should follow the cookie rather then switching the language\n    const contentLang = (_store$getState$conte = store.getState().content.get) !== null && _store$getState$conte !== void 0 && _store$getState$conte.error ? cookie_lang : ((_store$getState$conte2 = store.getState().content.data) === null || _store$getState$conte2 === void 0 ? void 0 : (_store$getState$conte3 = _store$getState$conte2.language) === null || _store$getState$conte3 === void 0 ? void 0 : _store$getState$conte3.token) || config.settings.defaultLanguage;\n    if (cookie_lang !== contentLang) {\n      const newLocale = toLangUnderscoreRegion(new locale.Locales(contentLang).best(supported).toString());\n      store.dispatch(changeLanguage(newLocale, locales[newLocale], req));\n    }\n    const context = {};\n    resetServerContext();\n    const markup = renderToString(__jsx(ChunkExtractorManager, {\n      extractor: extractor,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }\n    }, __jsx(CookiesProvider, {\n      cookies: req.universalCookies,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 11\n      }\n    }, __jsx(Provider, {\n      store: store,\n      onError: reactIntlErrorHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 13\n      }\n    }, __jsx(StaticRouter, {\n      context: context,\n      location: req.url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 15\n      }\n    }, __jsx(ReduxAsyncConnect, {\n      routes: routes,\n      helpers: api,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 17\n      }\n    }))))));\n    const readCriticalCss = config.settings.serverConfig.readCriticalCss || defaultReadCriticalCss;\n    if (context.url) {\n      res.redirect(flattenToAppURL(context.url));\n    } else if (context.error_code) {\n      var _config$settings$serv;\n      res.set({\n        'Cache-Control': 'no-cache'\n      });\n      res.status(context.error_code).send(`<!doctype html>\n              ${renderToString(__jsx(Html, {\n        extractor: extractor,\n        markup: markup,\n        store: store,\n        extractScripts: ((_config$settings$serv = config.settings.serverConfig.extractScripts) === null || _config$settings$serv === void 0 ? void 0 : _config$settings$serv.errorPages) || true,\n        criticalCss: readCriticalCss(req),\n        apiPath: res.locals.detectedHost || config.settings.apiPath,\n        publicURL: res.locals.detectedHost || config.settings.publicURL,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 17\n        }\n      }))}\n            `);\n    } else {\n      res.status(200).send(`<!doctype html>\n              ${renderToString(__jsx(Html, {\n        extractor: extractor,\n        markup: markup,\n        store: store,\n        criticalCss: readCriticalCss(req),\n        apiPath: res.locals.detectedHost || config.settings.apiPath,\n        publicURL: res.locals.detectedHost || config.settings.publicURL,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292,\n          columnNumber: 17\n        }\n      }))}\n            `);\n    }\n  }, errorHandler).catch(errorHandler);\n});\nexport const defaultReadCriticalCss = () => {\n  const {\n    criticalCssPath\n  } = config.settings.serverConfig;\n  const e = existsSync(criticalCssPath);\n  if (!e) return;\n  const f = lstatSync(criticalCssPath);\n  if (!f.isFile()) return;\n  return readFileSync(criticalCssPath, {\n    encoding: 'utf-8'\n  });\n};\n\n// Exposed for the console bootstrap info messages\nserver.apiPath = config.settings.apiPath;\nserver.devProxyToApiPath = config.settings.devProxyToApiPath;\nserver.proxyRewriteTarget = config.settings.proxyRewriteTarget;\nserver.publicURL = config.settings.publicURL;\nexport default server;","map":{"version":3,"names":["existsSync","lstatSync","readFileSync","React","StaticRouter","Provider","express","renderToString","createMemoryHistory","parse","parseUrl","locale","detect","path","ChunkExtractor","ChunkExtractorManager","resetServerContext","CookiesProvider","cookiesMiddleware","debug","routes","config","flattenToAppURL","Html","Api","persistAuthToken","normalizeLanguageName","toLangUnderscoreRegion","changeLanguage","userSession","ErrorPage","languages","configureStore","ReduxAsyncConnect","loadOnServer","locales","settings","supportedLanguages","forEach","lang","langFileName","then","default","reactIntlErrorHandler","error","supported","Locales","server","disable","head","req","res","send","use","middleware","expressMiddleware","filter","m","all","setupServer","length","err","next","store","locals","errorPage","url","message","set","ignoredErrors","includes","status","console","api","universalCookies","get","defaultLanguage","headers","best","toString","initialState","intl","defaultLocale","messages","history","initialEntries","errorHandler","process","env","RAZZLE_API_PATH","host","detectedHost","protocol","apiPath","publicURL","browserdetect","authToken","token","form","body","buildDir","BUILD_DIR","extractor","statsFile","resolve","join","entrypoints","originalUrl","location","cookie_lang","contentLang","getState","content","data","language","newLocale","dispatch","context","markup","readCriticalCss","serverConfig","defaultReadCriticalCss","redirect","error_code","extractScripts","errorPages","catch","criticalCssPath","e","f","isFile","encoding","devProxyToApiPath","proxyRewriteTarget"],"sources":["/Users/cihanandac/Documents/code-files/utrechtsciencepark/utrecht-science-park/frontend/node_modules/@plone/volto/src/server.jsx"],"sourcesContent":["/* eslint no-console: 0 */\nimport '@plone/volto/config'; // This is the bootstrap for the global config - server side\nimport { existsSync, lstatSync, readFileSync } from 'fs';\nimport React from 'react';\nimport { StaticRouter } from 'react-router-dom';\nimport { Provider } from 'react-intl-redux';\nimport express from 'express';\nimport { renderToString } from 'react-dom/server';\nimport { createMemoryHistory } from 'history';\nimport { parse as parseUrl } from 'url';\nimport { keys } from 'lodash';\nimport locale from 'locale';\nimport { detect } from 'detect-browser';\nimport path from 'path';\nimport { ChunkExtractor, ChunkExtractorManager } from '@loadable/server';\nimport { resetServerContext } from 'react-beautiful-dnd';\nimport { CookiesProvider } from 'react-cookie';\nimport cookiesMiddleware from 'universal-cookie-express';\nimport debug from 'debug';\n\nimport routes from '@root/routes';\nimport config from '@plone/volto/registry';\n\nimport {\n  flattenToAppURL,\n  Html,\n  Api,\n  persistAuthToken,\n  normalizeLanguageName,\n  toLangUnderscoreRegion,\n} from '@plone/volto/helpers';\nimport { changeLanguage } from '@plone/volto/actions';\n\nimport userSession from '@plone/volto/reducers/userSession/userSession';\n\nimport ErrorPage from '@plone/volto/error';\n\nimport languages from '@plone/volto/constants/Languages';\n\nimport configureStore from '@plone/volto/store';\nimport { ReduxAsyncConnect, loadOnServer } from './helpers/AsyncConnect';\n\nlet locales = {};\n\nif (config.settings) {\n  config.settings.supportedLanguages.forEach((lang) => {\n    const langFileName = normalizeLanguageName(lang);\n    import('@root/../locales/' + langFileName + '.json').then((locale) => {\n      locales = { ...locales, [lang]: locale.default };\n    });\n  });\n}\n\nfunction reactIntlErrorHandler(error) {\n  debug('i18n')(error);\n}\n\nconst supported = new locale.Locales(keys(languages), 'en');\n\nconst server = express()\n  .disable('x-powered-by')\n  .head('/*', function (req, res) {\n    // Support for HEAD requests. Required by start-test utility in CI.\n    res.send('');\n  })\n  .use(cookiesMiddleware());\n\nconst middleware = (config.settings.expressMiddleware || []).filter((m) => m);\n\nserver.all('*', setupServer);\nif (middleware.length) server.use('/', middleware);\n\nserver.use(function (err, req, res, next) {\n  if (err) {\n    const { store } = res.locals;\n    const errorPage = (\n      <Provider store={store} onError={reactIntlErrorHandler}>\n        <StaticRouter context={{}} location={req.url}>\n          <ErrorPage message={err.message} />\n        </StaticRouter>\n      </Provider>\n    );\n\n    res.set({\n      'Cache-Control': 'public, max-age=60, no-transform',\n    });\n\n    /* Displays error in console\n     * TODO:\n     * - get ignored codes from Plone error_log\n     */\n    const ignoredErrors = [301, 302, 401, 404];\n    if (!ignoredErrors.includes(err.status)) console.error(err);\n\n    res\n      .status(err.status || 500) // If error happens in Volto code itself error status is undefined\n      .send(`<!doctype html> ${renderToString(errorPage)}`);\n  }\n});\n\nfunction setupServer(req, res, next) {\n  const api = new Api(req);\n\n  const lang = new locale.Locales(\n    req.universalCookies.get('I18N_LANGUAGE') ||\n      config.settings.defaultLanguage ||\n      req.headers['accept-language'],\n  )\n    .best(supported)\n    .toString();\n\n  // Minimum initial state for the fake Redux store instance\n  const initialState = {\n    intl: {\n      defaultLocale: 'en',\n      locale: lang,\n      messages: locales[lang],\n    },\n  };\n\n  const history = createMemoryHistory({\n    initialEntries: [req.url],\n  });\n\n  // Create a fake Redux store instance for the `errorHandler` to render\n  // and for being used by the rest of the middlewares, if required\n  const store = configureStore(initialState, history, api);\n\n  function errorHandler(error) {\n    const errorPage = (\n      <Provider store={store} onError={reactIntlErrorHandler}>\n        <StaticRouter context={{}} location={req.url}>\n          <ErrorPage message={error.message} />\n        </StaticRouter>\n      </Provider>\n    );\n\n    res.set({\n      'Cache-Control': 'public, max-age=60, no-transform',\n    });\n\n    /* Displays error in console\n     * TODO:\n     * - get ignored codes from Plone error_log\n     */\n    const ignoredErrors = [301, 302, 401, 404];\n    if (!ignoredErrors.includes(error.status)) console.error(error);\n\n    res\n      .status(error.status || 500) // If error happens in Volto code itself error status is undefined\n      .send(`<!doctype html> ${renderToString(errorPage)}`);\n  }\n\n  if (!process.env.RAZZLE_API_PATH && req.headers.host) {\n    res.locals.detectedHost = `${\n      req.headers['x-forwarded-proto'] || req.protocol\n    }://${req.headers.host}`;\n    config.settings.apiPath = res.locals.detectedHost;\n    config.settings.publicURL = res.locals.detectedHost;\n  }\n\n  res.locals = {\n    ...res.locals,\n    store,\n    api,\n    errorHandler,\n  };\n\n  next();\n}\n\nserver.get('/*', (req, res) => {\n  const { errorHandler } = res.locals;\n\n  const api = new Api(req);\n\n  const browserdetect = detect(req.headers['user-agent']);\n\n  const lang = new locale.Locales(\n    req.universalCookies.get('I18N_LANGUAGE') ||\n      config.settings.defaultLanguage ||\n      req.headers['accept-language'],\n  )\n    .best(supported)\n    .toString();\n\n  const authToken = req.universalCookies.get('auth_token');\n  const initialState = {\n    userSession: { ...userSession(), token: authToken },\n    form: req.body,\n    intl: {\n      defaultLocale: 'en',\n      locale: lang,\n      messages: locales[lang],\n    },\n    browserdetect,\n  };\n\n  const history = createMemoryHistory({\n    initialEntries: [req.url],\n  });\n\n  // Create a new Redux store instance\n  const store = configureStore(initialState, history, api);\n\n  persistAuthToken(store, req);\n\n  // @loadable/server extractor\n  const buildDir = process.env.BUILD_DIR || 'build';\n  const extractor = new ChunkExtractor({\n    statsFile: path.resolve(path.join(buildDir, 'loadable-stats.json')),\n    entrypoints: ['client'],\n  });\n\n  const url = req.originalUrl || req.url;\n  const location = parseUrl(url);\n\n  loadOnServer({ store, location, routes, api })\n    .then(() => {\n      const cookie_lang =\n        req.universalCookies.get('I18N_LANGUAGE') ||\n        config.settings.defaultLanguage ||\n        req.headers['accept-language'];\n\n      // The content info is in the store at this point thanks to the asynconnect\n      // features, then we can force the current language info into the store when\n      // coming from an SSR request\n\n      // TODO: there is a bug here with content that, for any reason, doesn't\n      // present the language token field, for some reason. In this case, we\n      // should follow the cookie rather then switching the language\n      const contentLang = store.getState().content.get?.error\n        ? cookie_lang\n        : store.getState().content.data?.language?.token ||\n          config.settings.defaultLanguage;\n\n      if (cookie_lang !== contentLang) {\n        const newLocale = toLangUnderscoreRegion(\n          new locale.Locales(contentLang).best(supported).toString(),\n        );\n        store.dispatch(changeLanguage(newLocale, locales[newLocale], req));\n      }\n\n      const context = {};\n      resetServerContext();\n      const markup = renderToString(\n        <ChunkExtractorManager extractor={extractor}>\n          <CookiesProvider cookies={req.universalCookies}>\n            <Provider store={store} onError={reactIntlErrorHandler}>\n              <StaticRouter context={context} location={req.url}>\n                <ReduxAsyncConnect routes={routes} helpers={api} />\n              </StaticRouter>\n            </Provider>\n          </CookiesProvider>\n        </ChunkExtractorManager>,\n      );\n\n      const readCriticalCss =\n        config.settings.serverConfig.readCriticalCss || defaultReadCriticalCss;\n\n      if (context.url) {\n        res.redirect(flattenToAppURL(context.url));\n      } else if (context.error_code) {\n        res.set({\n          'Cache-Control': 'no-cache',\n        });\n\n        res.status(context.error_code).send(\n          `<!doctype html>\n              ${renderToString(\n                <Html\n                  extractor={extractor}\n                  markup={markup}\n                  store={store}\n                  extractScripts={\n                    config.settings.serverConfig.extractScripts?.errorPages ||\n                    process.env.NODE_ENV !== 'production'\n                  }\n                  criticalCss={readCriticalCss(req)}\n                  apiPath={res.locals.detectedHost || config.settings.apiPath}\n                  publicURL={\n                    res.locals.detectedHost || config.settings.publicURL\n                  }\n                />,\n              )}\n            `,\n        );\n      } else {\n        res.status(200).send(\n          `<!doctype html>\n              ${renderToString(\n                <Html\n                  extractor={extractor}\n                  markup={markup}\n                  store={store}\n                  criticalCss={readCriticalCss(req)}\n                  apiPath={res.locals.detectedHost || config.settings.apiPath}\n                  publicURL={\n                    res.locals.detectedHost || config.settings.publicURL\n                  }\n                />,\n              )}\n            `,\n        );\n      }\n    }, errorHandler)\n    .catch(errorHandler);\n});\n\nexport const defaultReadCriticalCss = () => {\n  const { criticalCssPath } = config.settings.serverConfig;\n\n  const e = existsSync(criticalCssPath);\n  if (!e) return;\n\n  const f = lstatSync(criticalCssPath);\n  if (!f.isFile()) return;\n\n  return readFileSync(criticalCssPath, { encoding: 'utf-8' });\n};\n\n// Exposed for the console bootstrap info messages\nserver.apiPath = config.settings.apiPath;\nserver.devProxyToApiPath = config.settings.devProxyToApiPath;\nserver.proxyRewriteTarget = config.settings.proxyRewriteTarget;\nserver.publicURL = config.settings.publicURL;\n\nexport default server;\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module","externalDependencies":[]}